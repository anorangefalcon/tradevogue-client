<section id="product-section">
    <div class="product-table d-flex flex-column gap-25">
        <div class="d-flex justify-content-md-between">
            <h3>Products Inventory</h3>
        </div>

        <div class="card card__pd-20 d-flex gap-20 align-item-center justify-content-md-between">
            <div class="file-section d-flex align-item-center gap-20">
                <input style="display: none;" type="file" id="sizes" maxlength="1" minlength="1"
                    (input)="uploadFile($event)"
                    accept="image/CSV, application/vnd.ms-excel ,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
                <label class="uploadbtn d-flex flex-center pointer gap-5" for="sizes">
                    <span class="material-symbols-outlined operation-icon">upload_file</span>
                    Import
                </label>

                <a class="downloadBtn d-flex flex-center pointer gap-5"
                    href="../../../assets/ExcelSampleFile/sampleFullData.xlsx" download>
                    <span class="material-symbols-outlined operation-icon">download</span>
                    Download Sample
                </a>
            </div>

            <div class="operational-buttons d-flex  flex-wrap gap-20">
                <button routerLink="/dashboard/addproduct"
                    class="btn btn-md btn-rounded d-flex align-item-center gap-5">
                    <i class="material-symbols-outlined operational-buttons-icons">add</i>
                    Add Product
                </button>
                <button class="btn btn-md btn-rounded d-flex align-item-center gap-5" [disabled]="!deleteList.length"
                    [ngStyle]="{'cursor': deleteList.length? 'pointer': 'no-drop'}"
                    (click)="deleteItem(deleteList, 'bulk')">
                    <i class="material-symbols-outlined operational-buttons-icons">delete</i>
                    Delete
                </button>
            </div>

        </div>

        <div class="card card__pd-20 d-flex flex-column">
            <div class="product-header filters d-flex gap-15 align-item-center justify-content-md-between mh100 mw100">
                <span class="search-bar mh100">
                    <app-search-bar [searchPlaceholder]="'Search by Name, Category.....'"
                        (searchQuery$)="updateFields($event, 'search')"></app-search-bar>
                </span>
                <!-- Product Inventory
                <app-custom-select class="options" [options]="stockStatus" [selectedOption]="'Filter by Stock Status'"
                    (final_option)="updateFields($event, 'stockStatus')"></app-custom-select> -->

                <span class="d-flex gap-15 align-item-center">
                    <!-- Product Category -->
                    <app-custom-select class="options" [options]="categoryOption"
                        [selectedOption]="template.filter.categories ? template.filter.categories: 'Filter by Category'"
                        (final_option)="updateFields($event, 'categories')"></app-custom-select>

                    <!-- Rating -->
                    <app-custom-select class="options" [options]="sortOption"
                        [selectedOption]="tempSortData? tempSortData: 'Sort by'"
                        (final_option)="updateFields($event)"></app-custom-select>
                    <button class="btn btn-xs btn-rounded fw-500 btn-primary" (click)="clearFields()">Clear</button>
                </span>
            </div>
        </div>
        <div class="table-list card">
            <table class="text-wrap">
                <thead>
                    <tr>
                        <th class="items item-check ">
                            <input [(ngModel)]="selectAll" (change)="toggleSelectAll();  updateCheckList();"
                                type="checkbox" id="all_product">
                            <label for='all_product' class="d-flex flex-center">
                                <span class="d-flex flex-center material-symbols-outlined">done</span>
                            </label>
                        </th>
                        <th class="items">Product Name</th>
                        <th class="items">Category</th>
                        <th class="items">Brand</th>
                        <th class="items">Price</th>
                        <th class="items">Unit Sold</th>
                        <th class="items">In Stock</th>
                        <th class="items">Rating</th>
                        <th class="items">Last Modified</th>
                        <th class="items">Action</th>
                    </tr>
                </thead>

                <tbody *ngIf="productList.length; else productData">
                    <ng-container *ngFor="let item of productList; let i = index">
                        <tr *ngIf="(i < template.limit)" class="default-animation">
                            <td class="items item-check">
                                <input [(ngModel)]="item.checked" type="checkbox"
                                    (change)="checkboxChanged(); updateCheckList();" id="itemId_{{item.itemId}}">
                                <label class="d-flex flex-center" for='itemId_{{item.itemId}}'>
                                    <span class="d-flex flex-center material-symbols-outlined">done</span>
                                </label>
                            </td>

                            <td class="items">
                                <div class="table__item-image d-flex gap-10 align-item-center mh100">
                                    <img src="{{item.image}}" loading="lazy" alt="product.png" width="100%"
                                        height="100%">
                                    <span>{{item.name}}</span>
                                </div>
                            </td>

                            <td class="items text-capitalize">{{item.category}}</td>
                            <td class="items text-capitalize">{{item.brand}}</td>
                            <td class="items">&#8377; {{item.price}}</td>

                            <td class="items"> {{item.unit_sold}} </td>

                            <td class="items displayInfo relative" (mouseleave)="selectedColor=0">
                                <div class="pointer relative d-flex align-item-center">

                                    <p (click)="displayInfo($event)">
                                        {{item.product_inventory}}<sup
                                            class="info__icon material-symbols-outlined">info</sup>
                                    </p>

                                    <div class="popup d-flex flex-column flex-center">

                                        <div class="popup_content relative d-flex flex-column flex-center gap-15">
                                            <h4 class="fs-12">Stock Inventory Status</h4>
                                            <span
                                                class="pointer close__icon d-flex flex-center absolute material-symbols-outlined"
                                                (click)="closeInfo($event)">close
                                            </span>

                                            <span class="d-flex justify-content-center align-item-center gap-10">
                                                <ng-container *ngFor="let c of item.assets; let c_index = index">
                                                    <input type="radio" [name]="'color1' + item.name"
                                                        [id]="'color1_'+ item.name + c.color" [value]="c.color"
                                                        (click)="isradioChecked($event, c_index)"
                                                        [checked]="c_index == 0" style="display: none;" />
                                                    <label class="pointer relative d-flex flex-center"
                                                        [for]="'color1_'+ item.name + c.color"
                                                        [style]="'background-color:'+ c.color"></label>
                                                </ng-container>
                                            </span>

                                            <div class="table-list">
                                                <table>
                                                    <thead>
                                                        <tr>
                                                            <th class="items">Size</th>
                                                            <th class="items">Sold</th>
                                                            <th class="items">Remaining Qty</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <ng-container [ngSwitch]="selectedColor">
                                                            <ng-container
                                                                *ngFor="let asset of item.assets; let asset_index=index">

                                                                <ng-container *ngSwitchCase="asset_index">
                                                                    <tr
                                                                        *ngFor="let stock of asset.stockQuantity; let x=index">
                                                                        <td class="items">{{stock.size}}</td>
                                                                        <td class="items">{{ stock.unitSold}}
                                                                        </td>
                                                                        <td class="items">
                                                                            <span class="inventory good"
                                                                                *ngIf="(stock.quantity) >= filterData(item.orderQuantity,stock.quantity)[filterData(item.orderQuantity,stock.quantity).length -1]; else low_inventry">
                                                                                In Stock
                                                                                &#40;{{stock.quantity}}&#41;
                                                                            </span>

                                                                            <ng-template #low_inventry>

                                                                                <span
                                                                                    *ngIf="( (stock.quantity) < filterData(item.orderQuantity,stock.quantity)[filterData(item.orderQuantity,stock.quantity).length -1]) && (stock.quantity) >= filterData(item.orderQuantity,stock.quantity)[0]; else empty_inventry"
                                                                                    class="inventory okay">
                                                                                    Low Inventory &#40;{{
                                                                                    stock.quantity }}&#41;
                                                                                </span>

                                                                                <ng-template #empty_inventry>
                                                                                    <span class="inventory bad">
                                                                                        Out of Stock &#40;{{
                                                                                        stock.quantity }}&#41;
                                                                                    </span>
                                                                                </ng-template>

                                                                            </ng-template>
                                                                        </td>
                                                                    </tr>
                                                                </ng-container>
                                                            </ng-container>
                                                        </ng-container>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </td>

                            <td class="items">
                                <div class="d-flex gap-5 align-item-center">
                                    <ng-container *ngFor="let star of starRating(item.rating)">
                                        <i [class]="star" style="color: rgb(var(--primaryClr));"></i>
                                    </ng-container>
                                    &#40;{{item.rating}}&#41;
                                </div>
                            </td>

                            <td class="items">{{item.last_updated}}</td>

                            <td class="items action-btns">
                                <span class="d-flex align-item-center gap-5 transition">

                                    <span class="tooltip">
                                        <input class="highlight" type="checkbox" style="display: none;"
                                            [id]="'highlight'+i" (click)="highlightProduct($event, item._id, i)"
                                            [(ngModel)]="item.highlight">
                                        <label class="pointer checkbox__label" [for]="'highlight'+i"></label>
                                        <span class="tooltiptext">Highlight Product</span>
                                    </span>

                                    <a class="tooltip" [routerLink]="['/dashboard/product-overview', item.itemId]">
                                        <span
                                            class="fs-20 mh100 mw100 action__btn-icon material-symbols-outlined">visibility</span>
                                        <span class="tooltiptext">View</span>
                                    </a>

                                    <a class="tooltip" [routerLink]="['/dashboard/editproduct', item.itemId]">
                                        <span
                                            class="fs-20 mh100 mw100 action__btn-icon material-symbols-outlined">edit</span>
                                        <span class="tooltiptext">Edit</span>
                                    </a>
                                    <a class="tooltip" (click)="deleteItem(item._id, item.name)">
                                        <span
                                            class="fs-20 mh100 mw100 action__btn-icon material-symbols-outlined">delete</span>
                                        <span class="tooltiptext">Delete</span>
                                    </a>
                                </span>
                            </td>
                        </tr>
                    </ng-container>
                </tbody>

                <ng-template #productData>
                    <tbody class="items" *ngIf="dataFetchStatus; else noData">
                        <tr *ngFor="let i of tableGenerator(template.limit)">
                            <td *ngFor="let i of tableGenerator(10)" class="items">
                                <div class="skeleton" style="border-radius: 5px; color: transparent"> d</div>
                            </td>
                        </tr>
                    </tbody>

                    <ng-template #noData>
                        <tbody>
                            <tr>
                                <td colspan="10">
                                    <div class="noDataFound d-flex flex-column flex-center card__pd-20">
                                        <img src="../../../assets/noDataFound.svg" alt="No Data Found" height="170px">
                                        <!-- <button class="btn btn-secondary btn-xs btn-rounded fw-500">Add Products</button> -->
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </ng-template>
                </ng-template>
            </table>
        </div>
    </div>

    <app-pagination [collectionSize]="totalCount" [pageSize]="pageSize" [currentPage]="currentPage"
        (activePage)="pageChange($event)"></app-pagination>
    <!-- PopUp Div -->
    <!-- <app-dialog [type]="'confirmation'" (reply)="response($event)"></app-dialog> -->
</section>