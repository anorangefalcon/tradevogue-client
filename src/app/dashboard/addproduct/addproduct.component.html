<section id="product-adding-section" class="d-flex flex-column gap-20">
    <div class="row d-flex justify-content-md-between">

        <div class="d-flex gap-15 align-item-center">

            <h2 *ngIf="current_form != 'product_images'; else title2">Basic Info</h2>
            <ng-template #title2>
                <span class="d-flex gap-15">
                    <h2>Product Images</h2>
                </span>
            </ng-template>
            <div class="next_prev_btn d-flex align-item-center gap-15">
                <button class="button previous d-flex flex-center" (click)="current_form = ''"
                    [disabled]="current_form == ''">
                    <span class="back_icon material-symbols-outlined">arrow_back_ios_new</span>
                </button>
    
                <button class="button next d-flex flex-center" (click)="current_form = 'product_images'"
                    [disabled]="current_form == 'product_images'">
                    <span class="next_icon material-symbols-outlined">arrow_forward_ios</span>
                </button>
            </div>
        </div>

        <div class="next_prev_btn d-flex align-item-center gap-15">

            <button class="btn-secondary d-flex flex-center gap-5" (click)="addProductImageForm()"
                [ngStyle]="{display: current_form != 'product_images'? 'none' : 'flex' }">
                <span class="form_icon material-symbols-outlined">add</span>
                Add Color Variant
            </button>

            <button class="btn-primary d-flex align-item-center" (click)="onsubmit()"
                [ngStyle]="{display: current_form != 'product_images'? 'none' : 'flex' }">
                Submit Product
            </button>

            <!-- <button class="button previous d-flex flex-center" (click)="current_form = ''"
                [disabled]="current_form == ''">
                <span class="back_icon material-symbols-outlined">arrow_back_ios_new</span>
            </button>
            <button class="button next d-flex align-item-center gap-5"
                    (click)="current_form = 'product_images'"
                    [disabled]="productsForm.get('basicinfo')?.invalid || current_form == 'product_images'"
                    [ngStyle]="{display: current_form == 'product_images'? 'none' : 'flex' }" >
                    <span class="material-symbols-outlined">arrow_forward_ios</span>
                </button>

            <button class="button next d-flex flex-center" (click)="current_form = 'product_images'"
                [disabled]="current_form == 'product_images'">
                <span class="next_icon material-symbols-outlined">arrow_forward_ios</span>
            </button> -->
        </div>
    </div>


    <form [formGroup]="productsForm">

        <ng-container [ngSwitch]="current_form">

            <ng-container *ngSwitchCase="'product_images'">
                <div class="d-flex flex-wrap gap-60" formArrayName="productDesc">
                    <ng-container *ngFor="let form of productImagesFormArray();let i=index">


                        <div [formGroupName]="i" class="product__image__card d-flex flex-column gap-20 relative">

                            <!-- Delete Button -->
                            <div class="absolute options d-flex flex-column gap-10 ">
                                <span class="options_icon count d-flex flex-center fs-16">{{i}}</span>
                                <i (click)="deleteFormGroup(i)" [ngStyle]="{'display': i !=0 ? 'flex': 'none'}"
                                    class="material-symbols-outlined options_icon delete__icon d-flex flex-center pointer transition">delete</i>
                            </div>

                            <div class="form__group">
                                <label [for]="'productImages'+ i" class="input__label">Product Images :</label>

                                <div class="product__image__container grid gap-15">
                                    <div class="upload__image relative">
                                        <input type="file" [id]="'productImages'+ i"
                                            accept="image/jpg, image/jpeg, image/png" maxlength="6" minlength="2"
                                            (change)="onImageUpload($event, i)" multiple />

                                        <label [for]="'productImages'+ i"
                                            class="upload__block d-flex flex-column flex-center pointer">
                                            <span class="upload_icon material-symbols-outlined"> cloud_upload
                                            </span>
                                            Upload Images
                                        </label>
                                    </div>
                                    <div class="images relative"
                                        *ngFor="let item of imagesArray(i); let imagesIndex=index">
                                        <img [src]="item.image" alt="productImage.png" width="100" height="100">
                                        <i class="remove-btn absolute pointer transition d-flex flex-center material-symbols-outlined"
                                            (click)="deleteImage(imagesIndex, i)">close</i>
                                    </div>
                                </div>

                            </div>

                            <div class="form__group ">
                                <label for="colors" class="input__label">Colors<span class="important">*</span></label>
                                <div class="color__picker d-flex gap-15 align-item-center">
                                    <span *ngFor="let c of common_colors; let x=index">
                                        <input type="radio" name="color" [id]="'color_'+i+x" style="display: none;"
                                            [value]="c" formControlName="color" />
                                        <label class="  pointer d-flex flex-center" [for]="'color_'+i+x"
                                            [style]="'background-color:'+c"></label>
                                    </span>
                                    <span class="error">
                                        <small
                                            *ngIf="form.get('colors')?.hasError('required') && form.get('colors')?.touched">*Field
                                            Required</small>
                                    </span>
                                </div>
                            </div>

                            <div class="form__group ">
                                <label for="quantity" class="input__label">Quantity Stock<span
                                        class="important">*</span></label>
                                <input type="number" class="form__input" placeholder="Quantity" id="quantity"
                                    formControlName="stockQuantity" required />

                                <span class="error"
                                    *ngIf="form.get('stockQuantity')?.invalid && (form.get('stockQuantity')?.dirty || form.get('stockQuantity')?.touched)">
                                    <small *ngIf="form.get('stockQuantity')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </ng-container>

            <ng-container *ngSwitchDefault>
                <div formGroupName="basicinfo" class="row d-flex gap-20">

                    <div class="col col-1">
                        <div class="form__group">
                            <label for="name" class="input__label">Product Name<span class="important">*</span></label>
                            <input type="text" class="form__input" id="name" placeholder="Name" #productName
                                formControlName="name">

                            <span class="error d-flex gap-20 flex-wrap"
                                *ngIf="productSubForm('name')?.invalid && (productSubForm('name')?.dirty || productSubForm('name')?.touched)">
                                <small *ngIf="productSubForm('name')?.hasError('required')">*Field Required</small>
                                <small *ngIf="productSubForm('name')?.hasError('invalidformat')">*Invalid
                                    Name</small>
                            </span>

                        </div>
                        <div class="form__group">
                            <label for="code" class="input__label">Product Code<span class="important">*</span></label>
                            <input type="text" class="form__input" id="code" placeholder="Product Code"
                                formControlName="code">

                            <span class="error d-flex flex-wrap"
                                *ngIf="productSubForm('code')?.invalid && (productSubForm('code')?.dirty || productSubForm('code')?.touched)">
                                <small *ngIf="productSubForm('code')?.hasError('required')">*Field Required</small>
                            </span>
                        </div>

                        <div class="form__group">
                            <label for="subtitle" class="input__label">Subtitle<span class="important">*</span></label>
                            <input type="text" class="form__input" id="subtitle" placeholder="Sub Title"
                                formControlName="subtitle" />

                            <span class="error d-flex flex-wrap"
                                *ngIf="productSubForm('subtitle')?.invalid && (productSubForm('subtitle')?.dirty || productSubForm('subtitle')?.touched)">
                                <small *ngIf="productSubForm('subtitle')?.hasError('required')">*Field
                                    Required</small>
                            </span>
                        </div>
                        <div class="form__group">
                            <label for="description" class="input__label">Product Description <span
                                    class="important">*</span></label>
                            <textarea class="form__input form__textarea" id="description"
                                placeholder="Product Details..." cols="30" rows="9" formControlName="description"
                                maxlength="800" (input)="letterCounter($event, 800)"></textarea>
                            <small class="note d-flex justify-content-md-between align-item-center">
                                *Description should not exceed 800 letters
                                <span>{{textarea_letterCount}} / 800</span>
                            </small>

                            <span class="error d-flex flex-wrap"
                                *ngIf="productSubForm('description')?.invalid && (productSubForm('description')?.dirty || productSubForm('description')?.touched)">
                                <small *ngIf="productSubForm('description')?.hasError('required')">*Field
                                    Required</small>
                            </span>
                        </div>
                    </div>

                    <div class="col col-2">
                        <div class="sub-block d-flex flex-wrap">
                            <div class="form__group">
                                <label for="category" class="input__label">Category<span
                                        class="important">*</span></label>
                                <app-custom-select id="categories" [options]="categories" [type]="'searchSelect'"
                                    [selectedOption]="'Select Category'"
                                    (final_option)="updateFormFields($event, 'category')"></app-custom-select>
                                <span class="error"
                                    *ngIf="productSubForm('category')?.invalid && (productSubForm('category')?.dirty || productSubForm('category')?.touched)">
                                    <small *ngIf="productSubForm('category')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="brand" class="input__label">Brand<span class="important">*</span></label>
                                <app-custom-select id="brand" [options]="brands" [type]="'searchSelect'"
                                    [selectedOption]="'Select Brand'"
                                    (final_option)="updateFormFields($event, 'brand')"></app-custom-select>
                                <span class="error"
                                    *ngIf="productSubForm('basicinfo')?.invalid && (productSubForm('basicinfo')?.dirty || productSubForm('basicinfo')?.touched)">
                                    <small *ngIf="productSubForm('basicinfo')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="gender" class="input__label">Gender<span class="important">*</span></label>
                                <app-custom-select id="gender" [options]="gender" [type]="'searchSelect'"
                                    [selectedOption]="'Select Gender'"
                                    (final_option)="updateFormFields($event, 'gender')"></app-custom-select>

                                <span class="error"
                                    *ngIf="productSubForm('gender')?.invalid && (productSubForm('gender')?.dirty || productSubForm('gender')?.touched)">
                                    <small *ngIf="productSubForm('gender')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="sizes" class="input__label">Size<span class="important">*</span></label>
                                <app-custom-select id="sizes" [options]="sizes" [type]="'multiSelect'"
                                    [selectedOption]="'Select Sizes'"
                                    (SelectedList)="updateFormFields($event, 'sizes')"></app-custom-select>
                                <span class="error"
                                    *ngIf="productSubForm('sizes')?.invalid && (productSubForm('sizes')?.dirty || productSubForm('sizes')?.touched)">
                                    <small *ngIf="productSubForm('sizes')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="" class="input__label">Product Tags<span class="important">*</span></label>
                                <app-custom-select [options]="tags" [type]="'multiSelect'"
                                    [selectedOption]="'Select Tags'"
                                    (SelectedList)="updateFormFields($event, 'tags')"></app-custom-select>
                                <span class="error"
                                    *ngIf="productSubForm('tags')?.invalid && (productSubForm('tags')?.dirty || productSubForm('tags')?.touched)">
                                    <small *ngIf="productSubForm('tags')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="price" class="input__label">Actual Price<span
                                        class="important">*</span></label>
                                <input type="number" class="form__input" placeholder="Actual Price" id="price"
                                    formControlName="actualprice" required
                                    onKeyPress="if(this.value.length == 7) return false;" />

                                <span class="error"
                                    *ngIf="productSubForm('actualprice')?.invalid && (productSubForm('actualprice')?.dirty || productSubForm('actualprice')?.touched)">
                                    <small *ngIf="productSubForm('actualprice')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="materialType" class="input__label">Material Type<span
                                        class="important">*</span></label>
                                <input type="text" class="form__input" placeholder="Material Type" id="materialType"
                                    formControlName="materialType" required />
                                <span class="error"
                                    *ngIf="productSubForm('materialType')?.invalid && (productSubForm('materialType')?.dirty || productSubForm('materialType')?.touched)">
                                    <small *ngIf="productSubForm('materialType')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="itemWeight" class="input__label">Item Weight<span
                                        class="important">*</span></label>
                                <input type="number" class="form__input" placeholder="Weight in gms" id="itemWeight"
                                    formControlName="weight" required />
                                <span class="error"
                                    *ngIf="productSubForm('weight')?.invalid && (productSubForm('weight')?.dirty || productSubForm('weight')?.touched)">
                                    <small *ngIf="productSubForm('weight')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                            <div class="form__group">
                                <label for="" class="input__label">Order Quantity<span
                                        class="important">*</span></label>
                                <app-custom-select [options]="orderQuantity" [type]="'multiSelect'"
                                    [selectedOption]="'Select Quantity'"
                                    (SelectedList)="updateFormFields($event, 'orderQuantity')"></app-custom-select>
                                <small class="note">*Order Quantity is various Unit to be Sold</small>
                                <span class="error"
                                    *ngIf="productSubForm('orderQuantity')?.invalid && (productSubForm('orderQuantity')?.dirty || productSubForm('orderQuantity')?.touched)">
                                    <small *ngIf="productSubForm('orderQuantity')?.hasError('required')">*Field
                                        Required</small>
                                </span>
                            </div>

                        </div>
                    </div>
                </div>
            </ng-container>
        </ng-container>
    </form>
</section>